<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emoji Accessibility Checker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Emoji Accessibility Checker</h1>
    <p class="text-center text-muted">Is your text with emoji accessible?</p>

    <div class="input-group mb-4">
      <input type="text" id="userInput" class="form-control" placeholder="Enter your text with emoji here..." />
      <button class="btn btn-primary" onclick="analyzeText()">Analyze</button>
    </div>

    <div id="results"></div>
  </div>

  <script>
    // Êõ¥Ê∫ñÁ¢∫ÁöÑ Emoji ÂÅµÊ∏¨
    function isEmoji(char) {
      return /\p{Extended_Pictographic}/u.test(char);
    }

    // ‰ΩøÁî® `Intl.Segmenter` Á¢∫‰øùÊú™‰æÜÈÅ©ÊáâÊÄßÂº∑
    function findRepeatedEmojiOnly(text) {
      const segmenter = new Intl.Segmenter("en", { granularity: "grapheme" });
      const chars = Array.from(segmenter.segment(text), s => s.segment);

      let results = [];
      let count = 1;
      let prev = chars[0];

      for (let i = 1; i < chars.length; i++) {
        if (prev === chars[i] && isEmoji(chars[i])) {
          count++;
        } else {
          if (count > 1 && isEmoji(prev)) {
            results.push({ emoji: prev, count });
          }
          count = 1;
        }
        prev = chars[i];
      }

      if (count > 1 && isEmoji(prev)) {
        results.push({ emoji: prev, count });
      }

      return results;
    }

    // ËºâÂÖ• emoji ÊîØÊè¥Ë≥áÊñôÔºàEmojibase CDNÔºâ
    async function loadEmojiSupportData() {
      const response = await fetch("https://cdn.jsdelivr.net/npm/emojibase-data/en/data.json");
      return await response.json();
    }

    // ÂæûË≥áÊñô‰∏≠ÊâæÂá∫ÂñÆ‰∏Ä emoji ÁöÑË≥áË®ä
    function findEmojiInfo(emoji, dataset) {
      return dataset.find(entry => entry.emoji === emoji);
    }

    function analyzeText() {
      const text = document.getElementById("userInput").value;
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = '';

      // Screen Reader Output
      const readerCard = document.createElement("div");
      readerCard.className = "card result-card p-3";
      const readerText = [...text].map(c => `<span>${c}</span>`).join('');
      readerCard.innerHTML = `
        <h5>üîä Screen Reader Output</h5>
        <p class="text-muted">Listen to how it sounds with a screen reader.</p>
        <div class="screen-reader-text">${readerText}</div>
        <button class="btn btn-outline-secondary mt-2" onclick="playText('${text.replace(/'/g, "\\'")}')">‚ñ∂ Play</button>
      `;
      resultsDiv.appendChild(readerCard);

      // Repeated Emoji
      const repeatedList = findRepeatedEmojiOnly(text);
      const repeatedCard = document.createElement("div");
      repeatedCard.className = "card result-card p-3";
      let repeatedStatus = '‚úÖ No excessive repetition detected';
      let repeatedClass = 'status-success';
      if (repeatedList.length > 0) {
        repeatedStatus = '‚ùå Found repeated emoji: ' + repeatedList.map(e => `${e.emoji} (${e.count} times)`).join(', ');
        repeatedClass = 'status-error';
        repeatedCard.classList.add('highlight-error');
      }
      repeatedCard.innerHTML = `
        <h5>üîÅ Repeated Emoji</h5>
        <p class="text-muted">Avoid using continuous and repeated emoji.</p>
        <p class="${repeatedClass}">${repeatedStatus}</p>
      `;
      resultsDiv.appendChild(repeatedCard);

      // Position of Emoji
      const startsWithEmoji = /^[\u231A-\uD83E\uDDFF]/.test(text);
      const positionCard = document.createElement("div");
      positionCard.className = "card result-card p-3";
      if (startsWithEmoji) positionCard.classList.add('highlight-error');
      positionCard.innerHTML = `
        <h5>üìç Position of Emoji</h5>
        <p class="text-muted">Ensure emojis are not at the beginning of the content.</p>
        <p class="${startsWithEmoji ? 'status-error' : 'status-success'}">
          ${startsWithEmoji ? '‚ùå Emoji found at the beginning of the sentence' : '‚úÖ Emoji is well positioned'}
        </p>
      `;
      resultsDiv.appendChild(positionCard);

      // Supported Emoji
      const supportedCard = document.createElement("div");
      supportedCard.className = "card result-card p-3";
      supportedCard.innerHTML = `
        <h5>üì± Supported Emoji</h5>
        <p class="text-muted">Check platform support and Unicode version.</p>
      `;
      const segmenter = new Intl.Segmenter("en", { granularity: "grapheme" });
      const emojiList = [...new Set(Array.from(segmenter.segment(text), s => s.segment).filter(isEmoji))];

      loadEmojiSupportData().then(dataset => {
        emojiList.forEach(char => {
          const info = findEmojiInfo(char, dataset);
          if (info) {
            supportedCard.innerHTML += `
              <div class="mb-2">
                <strong>${char}</strong> ‚Äì ${info.label}<br>
                Unicode: ${info.version}<br>
                Shortcode: :${info.shortcodes?.[0] || 'N/A'}:
              </div>`;
          } else {
            supportedCard.innerHTML += `<p class="status-warning">‚ö†Ô∏è ${char} ‚Äì Not found in database</p>`;
          }
        });
        resultsDiv.appendChild(supportedCard);
      });
    }

    // Web Speech API
    function playText(text) {
      const utterance = new SpeechSynthesisUtterance();
      utterance.lang = "en-US";
      const spans = document.querySelectorAll(".screen-reader-text span");
      let index = 0;
      utterance.text = text;
      utterance.onboundary = (event) => {
        if (event.name === 'word') {
          spans.forEach(span => span.classList.remove('active'));
          if (spans[index]) spans[index].classList.add('active');
          index++;
        }
      };
      speechSynthesis.cancel();
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
